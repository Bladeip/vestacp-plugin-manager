#!/usr/bin/env bash

source /usr/local/vesta/func/helpers.sh

plugin_name="$1"

plugin_path="/usr/local/vesta/plugins/$plugin_name"

if [[ ! "$plugin_name" ]]; then
    echo "Invalid arguments"
    exit 1
elif [[ ! -d "$plugin_path" ]]; then
    echo "Plugin \"$plugin_name\" is not installed"
    exit 1
fi

# Disable plugin to remove from vesta
/usr/local/vesta/bin/v-disable-plugin "$plugin_name"

# Remove plugin files
if [[ -L "$plugin_path" ]]; then
    unlink "$plugin_path"
else
    rm -rf "$plugin_path"
fi

# Remove plugin from vesta plugins list
delete_json_index "$plugin_name" /usr/local/vesta/conf/plugins.json
